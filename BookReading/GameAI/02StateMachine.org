* 状态驱动智能体设计

** 什么是有限状态机

一个有限状态机是一个设备或者是一个设备模型，具有有限数量的状态，它可以在任何给定的时间根据输入进行操作，使得从一个状态切换到另一个状态，或者是促使一个输出或者一种行为发生。
一个有限状态机在任何瞬间只能处在一种状态。
有限状态机

** 有限状态机的实现

*** 状态转换表

| 当前状态 | 条件              | 目标状态 |
|----------+--------------------+----------|
| 逃跑     | 安全            | 巡逻     |
| 攻击     | 比敌人弱         | 逃跑     |
| 巡逻     | 受到威胁并比敌人强 | 攻击     |
| 巡逻     | 受到威胁并比敌人弱 | 逃跑     |

*** 全局状态 和 状态返回

全局状态为了处理各种状态的统一逻辑而设计。
状态返回为了处理返回前一状态的需求。

** 消息机制
消息机制中包含了及时触发消息和延时触发消息。
延时触发消息存在以下问题：
当游戏整体加速时，延时应该缩短，否则延时触发消息就会有逻辑问题。
当某个角色加速时，其所发送的延时消息的延时应该缩短。
所以，延时触发消息应该通过ActionSpeed封装来做。

** 实例
*** 射击类游戏状态设计
角色包含两组状态
(1) Walking-Running
(2) Idle-Attacking

** 遇到的问题

*** 使用返回前一状态的时候会遇到的问题

XX->回家等待吃饭->吃饭 吃饭完毕后需要返回XX。
这种情况可以通过子状态来实现。XX->在家。在家包含两个子状态 等待吃饭 和 吃饭。

包含子状态的状态机实现
https://github.com/filasienof/qwe
http://jsfiddle.net/filasienof/m53ob1q6/light/